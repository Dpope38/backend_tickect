generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"

  // binaryTargets = ["debian-openssl-1.1.x", "native", "linux-openssl-3.0.x"]
  // Uncomment the following line to enable the `groupBy` preview feature
}

datasource db {
  provider = "postgresql"
}

enum Role {
  AGENT
  SUPERVISOR
  ADMIN
}

enum DepartmentStatus {
  ACTIVE
  INACTIVE
  PENDING
}

enum TicketStatus {
  OPEN
  PENDING
  RESOLVED
  CLOSED
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

model User {
  id           String      @id @default(uuid())
  fullname     String
  email        String      @unique
  departmentId String?
  department   Department? @relation(fields: [departmentId], references: [id])
  password     String
  role         Role        @default(AGENT)
  tickets      Ticket[]    @relation("AssignedTickets")
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

model Client {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  tickets   Ticket[] @relation("ClientTickets")
  createdAt DateTime @default(now())
}

model Ticket {
  id            String         @id @default(uuid())
  title         String
  description   String
  referenceCode String         @unique
  status        TicketStatus   @default(OPEN)
  priority      TicketPriority @default(LOW)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  departmentId  String?
  department    Department?    @relation(fields: [departmentId], references: [id])

  // Relations
  assignedAgentId String?
  assignedAgent   User?   @relation("AssignedTickets", fields: [assignedAgentId], references: [id])

  clientId String?
  client   Client? @relation("ClientTickets", fields: [clientId], references: [id])

  ticketHistories TicketHistory[]
}

model Department {
  id        String           @id @default(uuid())
  status    DepartmentStatus @default(ACTIVE)
  tickets   Ticket[]
  users     User[]
  details   String?
  teamName  String
  deptName  String           @unique
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
}

model TicketHistory {
  id        String         @id @default(uuid())
  ticketId  String
  status    TicketStatus
  priority  TicketPriority
  notes     String?
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  ticket Ticket @relation(fields: [ticketId], references: [id])
}
